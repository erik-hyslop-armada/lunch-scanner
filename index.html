<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Armada Lunch Ticket Scanner</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root { --ok:#d2ffd2; --no:#ffd2d2; }
    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      margin:0; padding:1rem; text-align:center;
    }
    #reader { margin:auto; margin-top:1rem; width:320px; max-width:90vw; }
    #status { margin-top:1rem; font-size:1.1rem; }
    #start-btn { padding:1rem 2rem; font-size:1.15rem; cursor:pointer; }
  </style>
</head>
<body>
  <h2>Scan lunch ticket</h2>
  <button id="start-btn">▶️ Start scanner</button>
  <div id="reader"></div>
  <div id="status"></div>

  <!--
    IMPORTANT: use the *ES‑module* build path so we get named exports.
    The root of the package doesn’t expose Html5Qrcode.
  -->
  <script type="module">
    import { Html5Qrcode } from "https://unpkg.com/html5-qrcode@2.3.8/esm/index.js";

    const btn = document.getElementById("start-btn");
    const status = document.getElementById("status");

    btn.addEventListener("click", async () => {
      try {
        const qr = new Html5Qrcode("reader");
        await qr.start(
          { facingMode: "environment" },
          { fps: 10, qrbox: 250 },
          async (text) => {
            try {
              const resp = await fetch(text);
              const html = await resp.text();
              status.innerHTML = html;
            } catch (e) {
              status.textContent = "Network error";
            }
            await qr.pause();
            setTimeout(() => qr.resume(), 1500);
          }
        );
        btn.remove();
        status.textContent = "Camera ready – point at QR";
      } catch (err) {
        status.textContent = "Camera initialisation failed: " + err;
      }
    });
  </script>
</body>
</html>
